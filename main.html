<html>
	<head>
		<title>Motion Chart Prototype in D3</title>
		<script src="http://mbostock.github.com/d3/d3.v2.js"></script>
		<style>
      .rule line {
        stroke: #eee;
      }

		</style>
	</head>
	<body>
    <script>
      var all_data = [
        [10, 20, 300, 34, 76, 10, 67, 87, 34, 22],
        [12, 54, 34, 55, 345, 55, 11, 22, 33, 44],
        [200, 23, 66, 77, 34, 23, 123, 34, 54, 66],
        [456, 33, 232, 222, 34, 67, 77, 123, 45, 56, 78]
      ];
      var data = all_data[0];
      var maxvalx = 0,
          minvalx = 1000000,
          maxvaly = 0,
          minvaly = 1000000,
          sampsize = 0;
      var val_array = [];
      sampsize = data.length;

      for (var i = 0; i < sampsize; i++) {
          val_array[i] = {
              label: data[i],
              x: parseFloat(i),
              y: parseFloat(data[i]),
              size: 5,
              color: "black"
          };
          maxvalx = Math.max(maxvalx, val_array[i].x);
          maxvaly = Math.max(maxvaly, val_array[i].y);
          minvalx = Math.min(minvalx, val_array[i].x);
          minvaly = Math.min(minvaly, val_array[i].y);
          //document.write('<p>Label: ' + label_array[i] + '</p>');
      }

      maxvalx = (1 + Math.floor(maxvalx / 10)) * 10;
      maxvaly = (10 + Math.floor(maxvaly / 10)) * 10;
      minvalx = (Math.floor(minvalx / 10)) * 10;
      minvaly = (Math.floor(minvaly / 10)) * 10 - 100;
      //document.write('<p>Max X: ' + minvalx + '</p>'); 
      //document.write('<p>Max Y: ' + minvaly + '</p>');

      var w = 815,
          h = 500,
          p = 80,
          x = d3.scale.linear().domain([0, maxvalx]).range([0, w]),
          y = d3.scale.linear().domain([minvaly, maxvaly]).range([h, 0]);

      var vis = d3.select("body")
                  .data([val_array])
                  .append("svg:svg")
                  .attr("width", w + p * 2)
                  .attr("height", h + p * 2)
                  .append("svg:g")
                  .attr("transform", "translate(" + p + "," + p + ")");

      var rules = vis.selectAll("g.rule")
                      .data(x.ticks(10))
                      .enter()
                      .append("svg:g")
                      .attr("class", "rule");

      // Draw grid lines
      rules.append("svg:line")
          .attr("x1", x)
          .attr("x2", x)
          .attr("y1", 0)
          .attr("y2", h - 1);

      rules.append("svg:line")
          .attr("class", function(d) { return d ? null : "axis"; })
          .data(y.ticks(10))
          .attr("y1", y)
          .attr("y2", y)
          .attr("x1", 0)
          .attr("x2", w - 10);

      // Place axis tick labels
      rules.append("svg:text")
          .attr("x", x)
          .attr("y", h + 15)
          .attr("dy", ".71em")
          .attr("text-anchor", "middle")
          .text(x.tickFormat(10))
          .text(String);

      rules.append("svg:text")
          .data(y.ticks(12))
          .attr("y", y)
          .attr("x", -10)
          .attr("dy", ".35em")
          .attr("text-anchor", "end")
          .text(y.tickFormat(5));

      // Draw xy scatterplot
      vis.selectAll("circle")
          .data(val_array)
          .enter()
          .append("svg:circle")
          .attr("class", "line")
          .attr("fill", function(d) { return d.color; })
          .attr("cx", function(d) { return x(d.x); })
          .attr("cy", function(d) { return y(d.y) - 5; })
          .attr("r", function(d) { return d.size });

      // add bubble labels: in two steps
      vis.selectAll("g.rule")
          .data(val_array)
          .append("svg:text")
          .attr("text-anchor", "middle")
          .attr("x", function(d) { return x(d.x); })
          .attr("y", function(d) { return y(d.y) + d.size + 4; })
          .attr("dy", ".3em")
          .attr("fill", "black")
          .attr("class", "datalabels")
          .attr("clip", "inherit")
          .text(function(d) { return d.label; });
              
      vis.selectAll("g.rule")
          .data(val_array)
         .enter().append("svg:text")
           .attr("text-anchor", "middle")
           .attr("x", function(d) { return x(d.x); })
           .attr("y", function(d) { return y(d.y) + d.size + 4; })
           .attr("dy", ".3em")
           .attr("fill", "black")
           .attr("clip", "inherit")
           .text(function(d) { return d.label; });
              
      function get_val_array(simple_array) {
          var val_array = new Array();
          for (var i = 0; i < simple_array.length; i++) {
              val_array[i] = {
                  label: simple_array[i],
                  x: parseFloat(i),
                  y: parseFloat(simple_array[i]),
                  size: 5,
                  color: "black"
              };
          }
          return val_array
      }

      var i = 0

      setInterval( function(){
          if (i == all_data.length) {
              return            
          }
          var data = get_val_array(all_data[i])
          redraw(data)
          i = i + 1
      } ,1000);

      function redraw(data) {
          
          var transition_duration = 1000;
          
          vis.selectAll("circle")
              .data(data)
              .transition()
              .duration(transition_duration)
              .attr("cy", function(d) { return y(d.y) - 5; });
          
          vis.selectAll(".datalabels")
              .data(data)
              .transition()
              .duration(transition_duration)
              .attr("y", function(d) { return y(d.y) + d.size + 4; })
              .text(function(d) { return d.label; });
      }
    </script>
	</body>
</html>